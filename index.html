<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Biarritz – bokning (valfria datum)</title>
  <meta name="description" content="Boka det sista dubbelrummet i Biarritz för valfri datumperiod. Pris per dag." />
  <style>
    :root{
      --bg:#0b0c0f; --panel:#151821; --muted:#8b93a7; --text:#e7ebf3;
      --accent:#6be675; --accent-2:#3da1ff; --danger:#ff5c77;
      --shadow:0 10px 30px rgba(0,0,0,.35),0 2px 6px rgba(0,0,0,.25);
      --radius:14px;
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f5f7fb; --panel:#fff; --muted:#6b7280; --text:#0b1020;
        --accent:#16a34a; --accent-2:#2563eb; --danger:#e11d48;
        --shadow:0 10px 30px rgba(0,0,0,.1),0 2px 6px rgba(0,0,0,.08);
      }
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    a{color:var(--accent-2);text-decoration:none} a:hover{text-decoration:underline}
    .wrap{max-width:980px;margin:32px auto;padding:0 16px}
    header{
      display:grid;gap:14px;margin-bottom:22px;align-items:center;
      grid-template-columns:64px 1fr auto;
      background:linear-gradient(180deg, rgba(255,255,255,.04), transparent), var(--panel);
      border-radius:var(--radius); padding:20px; box-shadow:var(--shadow);
    }
    .logo{width:56px;height:56px;border-radius:12px;display:grid;place-items:center;background:radial-gradient(100px 100px at 20% 15%, rgba(255,255,255,.15), transparent), linear-gradient(135deg,#141a28,#0d111a);box-shadow:inset 0 0 0 1px rgba(255,255,255,.06)}
    .logo svg{width:28px;height:28px}
    .badge{display:inline-block;border:1px solid rgba(255,255,255,.12);padding:3px 10px;border-radius:40px;color:var(--muted);font-weight:600;letter-spacing:.2px;font-size:12px}
    h1{margin:0;font-size:22px}
    .muted{color:var(--muted)}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .spacer{flex:1}
    .chip{background:var(--panel);border:1px solid rgba(255,255,255,.08);padding:8px 12px;border-radius:10px}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.03), transparent), var(--panel); border-radius:var(--radius); padding:16px; box-shadow:var(--shadow); border:1px solid rgba(255,255,255,.06); display:grid; gap:12px}
    label{font-weight:600;font-size:14px}
    input[type="text"],input[type="email"],input[type="date"],select,textarea{
      width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.04);color:var(--text);outline:none
    }
    textarea{min-height:80px;resize:vertical}
    .btn{appearance:none;border:0;border-radius:12px;padding:10px 14px;background:var(--accent);color:#0a0f14;font-weight:800;letter-spacing:.2px;cursor:pointer;box-shadow:var(--shadow)}
    .btn.secondary{background:transparent;color:var(--text);border:1px dashed rgba(255,255,255,.25)}
    .help{font-size:12px;color:var(--muted)}
    .price-line{font-weight:800}
    .status{font-size:13px}
    .list{display:grid;gap:8px}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.04)}
    .toast{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);background:var(--panel);border:1px solid rgba(255,255,255,.15);padding:10px 14px;border-radius:12px;box-shadow:var(--shadow);display:none}
    footer{margin:20px 0;color:var(--muted);font-size:14px}
    dialog{border:0;border-radius:16px;background:var(--panel);color:var(--text);padding:0;box-shadow:var(--shadow);max-width:580px;width:92vw}
    dialog::backdrop{background:rgba(0,0,0,.55)}
    .modal-head{padding:16px 18px;border-bottom:1px solid rgba(255,255,255,.08);display:flex;gap:10px;align-items:center}
    .modal-body{padding:18px;display:grid;gap:12px}
    .close{border:0;background:transparent;color:var(--muted);cursor:pointer;font-size:24px;line-height:1}
    .admin{display:none;margin-top:10px}
    .admin.show{display:block}
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="hero">
  <img src="IMG_1392.png" alt="Huset i Biarritz med pool" 
       style="width:100%; border-radius:14px; margin:20px 0;">
</div>
    <div class="logo" aria-hidden="true">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 3l8 4.5v9L12 21l-8-4.5v-9L12 3z"/><path d="M12 3v18M4 7.5l8 4.5 8-4.5"/></svg>
    </div>
    <div>
      <div class="badge">Biarritz • Höst 2025</div>
      <h1>Boka sista dubbelrummet – valfria datum</h1>
      <div class="muted">Tillgängligt mellan <strong>7 september</strong> och <strong>25 oktober 2025</strong>.</div>
    </div>
    <div>
      <div class="chip">Singel: <strong id="priceSingleDay">—</strong> / dag</div>
      <div class="chip">Par: <strong id="pricePairDay">—</strong> / dag</div>
    </div>
  </header>

  <div class="grid">
    <div class="card">
      <div class="row">
        <div style="flex:1">
          <label for="checkin">Incheckning</label>
          <input id="checkin" type="date" />
        </div>
        <div style="flex:1">
          <label for="checkout">Utcheckning</label>
          <input id="checkout" type="date" />
          <div class="help">Utcheckning är exklusiv (sista natten är dagen före).</div>
        </div>
      </div>

      <div class="row">
        <div style="flex:1">
          <label for="type">Antal gäster</label>
          <select id="type">
            <option value="single">Singel</option>
            <option value="pair">Par</option>
          </select>
        </div>
        <div style="flex:1">
          <label>Sammanfattning</label>
          <div class="price-line" id="summary">—</div>
          <div class="help">Pris per dag beräknas från veckopris (7 dagar).</div>
        </div>
      </div>

      <div class="row">
        <button class="btn" id="openBooking">Boka</button>
        <button class="btn secondary" id="icsBtn" type="button">Ladda ner .ics</button>
        <div class="spacer"></div>
        <span class="status" id="availability">—</span>
      </div>
    </div>

    <div class="card">
      <strong>Bokningar (lokalt)</strong>
      <div id="bookingsList" class="list"></div>
      <div class="help">OBS: Synkas inte mellan enheter – bekräfta alltid via e-post.</div>
      <div id="admin" class="admin">
        <hr>
        <button class="btn secondary" id="reset">Återställ alla bokningar (lokalt)</button>
      </div>
    </div>
  </div>

 <div class="room">
  <h2>Rummet</h2>
  <img src="IMG_1394.png" alt="Dubbelrummet i huset" style="max-width:100%; border-radius:10px;">
</div>
  <footer>
    Tips: Publicera som GitHub Pages eller dela filen direkt. Lägg till <code>#admin</code> i URL:en för att visa återställningsknappen.
  </footer>
</div>

<dialog id="bookDlg" aria-label="Bokning">
  <form method="dialog" id="bookForm">
    <div class="modal-head">
      <div class="spacer">
        <div><strong id="selDates">—</strong></div>
        <div class="help" id="selGuests">—</div>
      </div>
      <button class="close" type="button" id="closeDlg" aria-label="Stäng">×</button>
    </div>
    <div class="modal-body">
      <div class="row">
        <div style="flex:1">
          <label for="name">Namn</label>
          <input id="name" type="text" required placeholder="För- och efternamn" autocomplete="name" />
        </div>
        <div style="flex:1">
          <label for="email">E-post</label>
          <input id="email" type="email" required placeholder="namn@example.com" autocomplete="email" />
        </div>
      </div>
      <div>
        <label for="note">Meddelande (valfritt)</label>
        <textarea id="note" placeholder="Eventuella frågor eller önskemål"></textarea>
      </div>
      <div class="row">
        <div class="price-line" id="priceLine">—</div>
        <div class="spacer"></div>
        <button class="btn" id="confirmBtn" type="submit">Boka & skapa e-post</button>
      </div>
      <div class="help">När du bokar öppnas ditt e-postprogram med ett färdigifyllt meddelande till värden.</div>
    </div>
  </form>
</dialog>

<div class="toast" id="toast" role="status" aria-live="polite"></div>

<script>
const CONFIG = {
  seasonStart: "2025-09-07",
  seasonEnd:   "2025-10-25",
  ownerEmail:  "anton@1000skis.com",
  currency:    "SEK",
  weekly:      { single: 2100, pair: 3000 }, // källpriser
  houseName:   "Biarritz – dubbelrum",
  location:    "Biarritz, Frankrike"
};
const STORAGE_KEY = "biarritzBookings2025_RANGE";

// —— Helpers ——
const dmy = (d, opts={}) => new Intl.DateTimeFormat("sv-SE",{day:"numeric",month:"short", ...opts}).format(d);
const fmtMoney = (n) => new Intl.NumberFormat("sv-SE",{maximumFractionDigits:0}).format(Math.round(n)) + " " + CONFIG.currency;
const iso = (d) => d.toISOString().slice(0,10);
const parse = (isoStr) => new Date(isoStr + "T12:00:00");
const nightsBetween = (a,b) => Math.max(0, Math.round((b - a) / 86400000));
const overlap = (aStart,aEnd,bStart,bEnd) => (aStart < bEnd) && (aEnd > bStart);
const withinSeason = (d) => d >= parse(CONFIG.seasonStart) && d <= parse(CONFIG.seasonEnd);

// priser per dag från veckopris
const perDay = {
  single: CONFIG.weekly.single / 7,
  pair:   CONFIG.weekly.pair   / 7
};

// DOM
const checkin = document.getElementById("checkin");
const checkout = document.getElementById("checkout");
const typeSel = document.getElementById("type");
const summary = document.getElementById("summary");
const availability = document.getElementById("availability");
const priceSingleDay = document.getElementById("priceSingleDay");
const pricePairDay = document.getElementById("pricePairDay");
const openBookingBtn = document.getElementById("openBooking");
const listEl = document.getElementById("bookingsList");

// modal
const dlg = document.getElementById("bookDlg");
const selDates = document.getElementById("selDates");
const selGuests = document.getElementById("selGuests");
const nameInp = document.getElementById("name");
const emailInp = document.getElementById("email");
const noteArea = document.getElementById("note");
const priceLine = document.getElementById("priceLine");

// init UI
priceSingleDay.textContent = fmtMoney(perDay.single);
pricePairDay.textContent   = fmtMoney(perDay.pair);

// säsongsgränser i inputs
checkin.min = CONFIG.seasonStart;
checkin.max = CONFIG.seasonEnd;
checkout.min = CONFIG.seasonStart;
checkout.max = CONFIG.seasonEnd;

// load bookings
function load(){ try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); } catch(e){ return []; } }
function save(b){ localStorage.setItem(STORAGE_KEY, JSON.stringify(b)); }
let bookings = load();

// render bookings list
function renderBookings(){
  listEl.innerHTML = "";
  if (bookings.length === 0){
    const p = document.createElement("div");
    p.className = "muted"; p.textContent = "Inga bokningar än.";
    listEl.appendChild(p);
    return;
  }
  bookings.sort((a,b)=> a.start.localeCompare(b.start));
  bookings.forEach(bk => {
    const div = document.createElement("div");
    const a = parse(bk.start), b = parse(bk.end);
    div.innerHTML = `<span class="pill">${dmy(a)}–${dmy(new Date(b-86400000))} (${nightsBetween(a,b)} nätter) – ${bk.type==="single"?"Singel":"Par"} – ${fmtMoney(bk.total)}</span>`;
    listEl.appendChild(div);
  });
}
renderBookings();

// summary/availability calc
function recalc(){
  const sVal = checkin.value, eVal = checkout.value;
  if(!sVal || !eVal){ summary.textContent = "Välj datum."; availability.textContent = "—"; return; }
  const s = parse(sVal), e = parse(eVal);
  if (!(withinSeason(s) && withinSeason(e))) {
    summary.textContent = "Datum måste ligga inom säsong."; availability.textContent = "❌ Utanför säsong"; return;
  }
  if (e <= s){ summary.textContent = "Utcheckning måste vara efter incheckning."; availability.textContent = "❌ Ogiltigt intervall"; return; }
  const nights = nightsBetween(s,e);
  const pd = perDay[typeSel.value];
  const total = Math.round(pd * nights);
  const free = bookings.every(bk => !overlap(s,e, parse(bk.start), parse(bk.end)));
  summary.textContent = `${nights} natt${nights!==1?"er":""} · ${typeSel.value==="single"?"Singel":"Par"} · ${fmtMoney(pd)} / dag · Totalt ${fmtMoney(total)}`;
  availability.textContent = free ? "✅ Tillgängligt" : "❌ Krockar med annan bokning";
  availability.style.color = free ? "" : "var(--danger)";
}
["change","input"].forEach(ev=>{
  checkin.addEventListener(ev,recalc);
  checkout.addEventListener(ev,recalc);
  typeSel.addEventListener(ev,recalc);
});
recalc();

// open modal
document.getElementById("openBooking").addEventListener("click", ()=>{
  const sVal = checkin.value, eVal = checkout.value;
  if(!sVal || !eVal) { alert("Välj in- och utcheckning först."); return; }
  const s = parse(sVal), e = parse(eVal);
  if (e <= s) { alert("Utcheckning måste vara efter incheckning."); return; }
  // check availability
  if (!bookings.every(bk => !overlap(s,e, parse(bk.start), parse(bk.end)))){
    alert("Valda datum krockar med en befintlig bokning."); return;
  }
  const nights = nightsBetween(s,e);
  const pd = perDay[typeSel.value], total = Math.round(pd * nights);
  selDates.textContent = `${dmy(s,{weekday:"short"})} – ${dmy(new Date(e-86400000),{weekday:"short"})} (${nights} natt${nights!==1?"er":""})`;
  selGuests.textContent = `${typeSel.value==="single"?"Singel":"Par"} · ${fmtMoney(pd)} / dag · Totalt ${fmtMoney(total)}`;
  priceLine.textContent = `Summa: ${fmtMoney(total)}`;
  dlg.showModal();
  setTimeout(()=> nameInp.focus(), 0);
});
document.getElementById("closeDlg").addEventListener("click", ()=> dlg.close());

// confirm booking (mailto + save)
document.getElementById("bookForm").addEventListener("submit", (e)=>{
  e.preventDefault();
  const s = parse(checkin.value), eDate = parse(checkout.value);
  const nights = nightsBetween(s,eDate);
  const pd = perDay[typeSel.value], total = Math.round(pd * nights);
  // save
  bookings.push({
    start: iso(s), end: iso(eDate),
    type: typeSel.value, name: nameInp.value.trim(), email: emailInp.value.trim(),
    note: noteArea.value.trim(), total, ts: Date.now()
  });
  save(bookings);
  renderBookings();
  recalc();
  dlg.close();

  const who = typeSel.value === "single" ? "Singel" : "Par";
  const subject = encodeURIComponent(`[Bokning] ${CONFIG.houseName} – ${dmy(s)}–${dmy(new Date(eDate-86400000))} (${nights} nätter) – ${who} – ${nameInp.value.trim()}`);
  const lines = [
    `Hej!`,
    ``,
    `Jag vill boka ${CONFIG.houseName} i ${CONFIG.location}.`,
    `Incheckning: ${iso(s)}`,
    `Utcheckning: ${iso(eDate)} (exklusiv)`,
    `Nätter: ${nights}`,
    `Gäster: ${who}`,
    `Pris per dag: ${fmtMoney(pd)}`,
    `Summa: ${fmtMoney(total)}`,
    ``,
    `Namn: ${nameInp.value.trim()}`,
    `E-post: ${emailInp.value.trim()}`,
    noteArea.value.trim() ? `Meddelande: ${noteArea.value.trim()}` : ``,
    ``,
    `Skapad från bokningssidan. Vänligen bekräfta via svar.`
  ].filter(Boolean);
  const body = encodeURIComponent(lines.join("\n"));
  const mailto = `mailto:${encodeURIComponent(CONFIG.ownerEmail)}?subject=${subject}&body=${body}`;
  window.location.href = mailto;
  toast("Öppnar e-post för att skicka bokningen…");
});

// ICS download
document.getElementById("icsBtn").addEventListener("click", ()=>{
  if(!checkin.value || !checkout.value) { alert("Välj datum först."); return; }
  const s = parse(checkin.value), e = parse(checkout.value);
  if (e <= s) { alert("Utcheckning måste vara efter incheckning."); return; }
  const toICSDate = (d) => d.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z";
  const dtStart = new Date(Date.UTC(s.getFullYear(), s.getMonth(), s.getDate()));
  const dtEnd   = new Date(Date.UTC(e.getFullYear(), e.getMonth(), e.getDate())); // end-exclusive
  const uid = `biarritz-${iso(s)}-${iso(e)}@1000skis`;
  const ics = [
    "BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Biarritz Booking//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH",
    "BEGIN:VEVENT",
    `UID:${uid}`,
    `SUMMARY:${CONFIG.houseName}`,
    `DTSTART;VALUE=DATE:${toICSDate(dtStart).slice(0,8)}`,
    `DTEND;VALUE=DATE:${toICSDate(dtEnd).slice(0,8)}`,
    `LOCATION:${CONFIG.location}`,
    "DESCRIPTION:Bokad datumperiod i Biarritz.",
    "END:VEVENT","END:VCALENDAR"
  ].join("\r\n");
  const blob = new Blob([ics], {type:"text/calendar"});
  const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = `Biarritz_${iso(s)}_${iso(e)}.ics`; document.body.appendChild(a); a.click(); a.remove();
});

// toast + admin
function toast(msg){
  const el = document.getElementById("toast");
  el.textContent = msg; el.style.display="block";
  setTimeout(()=> el.style.display="none", 2200);
}
if (location.hash.includes("admin")){
  const admin = document.getElementById("admin");
  admin.classList.add("show");
  document.getElementById("reset").addEventListener("click", ()=>{
    if(confirm("Är du säker på att du vill radera alla bokningar (lokalt)?")){
      localStorage.removeItem(STORAGE_KEY);
      bookings = [];
      renderBookings();
      recalc();
      toast("Alla bokningar raderade (lokalt).");
    }
  });
}
</script>
</body>
</html>
